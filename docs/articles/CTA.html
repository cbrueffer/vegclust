<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Community trajectory analysis • vegclust</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Community trajectory analysis">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vegclust</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.7.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CTA.html">Community trajectory analysis</a>
    </li>
    <li>
      <a href="../articles/MedRegExample.html">Describing vegetation in terms of structure and composition</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Community trajectory analysis</h1>
                        <h4 class="author">Miquel De Cáceres</h4>
            
            <h4 class="date">2018-08-29</h4>
      
      
      <div class="hidden name"><code>CTA.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>1. Introduction</h2>
<p><em>Community trajectory analysis</em> (CTA) is a framework to analyze community dynamics described as trajectories in a chosen space of community resemblance. CTA takes trajectories as objects to be analyzed and compared geometrically. Given a distance matrix between community states and vectors defining sites (i.e. sampling units) and surveys (temporal replications), package <strong>vegclust</strong> offers a set of functions to perform CTA. In this vignette you will learn how to conduct CTA using different package functions. First of all, we load <code>vegclust</code> and other libraries needed in this document:</p>
<pre class="sourceCode r" id="cb1"><code class="sourceCode r"><div class="sourceLine" id="cb1-1" data-line-number="1">
<span class="kw">library</span>(vegclust)</div></code></pre>
<pre><code>## Loading required package: Rcpp</code></pre>
<pre class="sourceCode r" id="cb3"><code class="sourceCode r"><div class="sourceLine" id="cb3-1" data-line-number="1">
<span class="kw">library</span>(RColorBrewer)</div>
<div class="sourceLine" id="cb3-2" data-line-number="2">
<span class="kw">library</span>(smacof)</div></code></pre>
<pre><code>## Loading required package: plotrix</code></pre>
<pre><code>## 
## Attaching package: 'smacof'</code></pre>
<pre><code>## The following object is masked from 'package:base':
## 
##     transform</code></pre>
<pre class="sourceCode r" id="cb7"><code class="sourceCode r"><div class="sourceLine" id="cb7-1" data-line-number="1">
<span class="kw">library</span>(MASS)</div></code></pre>
</div>
<div id="simple-example" class="section level2">
<h2 class="hasAnchor">
<a href="#simple-example" class="anchor"></a>2. Simple example</h2>
<p>In this section we describe how to study the trajectories of three sites that have been surveyed four times each. We use a small dataset where trajectories occur in a space of two dimensions, so that geometric calculations can be followed more easily.</p>
<div id="trajectory-data" class="section level3">
<h3 class="hasAnchor">
<a href="#trajectory-data" class="anchor"></a>2.1 Trajectory data</h3>
<p>To specify community dynamics, we need three data items:</p>
<ol style="list-style-type: lower-alpha">
<li>A set of community states (i.e. coordinates in a space <span class="math inline">\(\Omega\)</span>), described using a distance matrix <span class="math inline">\(d\)</span>;</li>
<li>A vector specifying the site (i.e. sampling unit) corresponding to each community state;</li>
<li>A vector specifying the survey (i.e. time point) corresponding to the sampling of each community state.</li>
</ol>
<p>In CTA sampling units do not need to be surveyed synchronously nor the same number of times. However, in this example we assume all three sites have been surveyed synchronously four times.</p>
<p>Let us first define the vectors that describe the site and the survey of each community state:</p>
<pre class="sourceCode r" id="cb8"><code class="sourceCode r"><div class="sourceLine" id="cb8-1" data-line-number="1"><span class="co">#Description of sites and surveys</span></div>
<div class="sourceLine" id="cb8-2" data-line-number="2">sites =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>)</div>
<div class="sourceLine" id="cb8-3" data-line-number="3">surveys=<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)</div></code></pre>
<p>We then build a matrix with the coordinates corresponding to the community states of the three sites during each survey. We assume that the community space <span class="math inline">\(\Omega\)</span> has two dimensions:</p>
<pre class="sourceCode r" id="cb9"><code class="sourceCode r"><div class="sourceLine" id="cb9-1" data-line-number="1"><span class="co">#Raw data table</span></div>
<div class="sourceLine" id="cb9-2" data-line-number="2">xy&lt;-<span class="kw">matrix</span>(<span class="dv">0</span>, <span class="dt">nrow=</span><span class="dv">12</span>, <span class="dt">ncol=</span><span class="dv">2</span>)</div>
<div class="sourceLine" id="cb9-3" data-line-number="3">xy[<span class="dv">2</span>,<span class="dv">2</span>]&lt;-<span class="dv">1</span>
</div>
<div class="sourceLine" id="cb9-4" data-line-number="4">xy[<span class="dv">3</span>,<span class="dv">2</span>]&lt;-<span class="dv">2</span>
</div>
<div class="sourceLine" id="cb9-5" data-line-number="5">xy[<span class="dv">4</span>,<span class="dv">2</span>]&lt;-<span class="dv">3</span>
</div>
<div class="sourceLine" id="cb9-6" data-line-number="6">xy[<span class="dv">5</span><span class="op">:</span><span class="dv">6</span>,<span class="dv">2</span>] &lt;-<span class="st"> </span>xy[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,<span class="dv">2</span>]</div>
<div class="sourceLine" id="cb9-7" data-line-number="7">xy[<span class="dv">7</span>,<span class="dv">2</span>]&lt;-<span class="fl">1.5</span>
</div>
<div class="sourceLine" id="cb9-8" data-line-number="8">xy[<span class="dv">8</span>,<span class="dv">2</span>]&lt;-<span class="fl">2.0</span>
</div>
<div class="sourceLine" id="cb9-9" data-line-number="9">xy[<span class="dv">5</span><span class="op">:</span><span class="dv">6</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="fl">0.25</span>
</div>
<div class="sourceLine" id="cb9-10" data-line-number="10">xy[<span class="dv">7</span>,<span class="dv">1</span>]&lt;-<span class="fl">0.5</span>
</div>
<div class="sourceLine" id="cb9-11" data-line-number="11">xy[<span class="dv">8</span>,<span class="dv">1</span>]&lt;-<span class="fl">1.0</span>
</div>
<div class="sourceLine" id="cb9-12" data-line-number="12">xy[<span class="dv">9</span><span class="op">:</span><span class="dv">10</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span>xy[<span class="dv">5</span><span class="op">:</span><span class="dv">6</span>,<span class="dv">1</span>]<span class="op">+</span><span class="fl">0.25</span>
</div>
<div class="sourceLine" id="cb9-13" data-line-number="13">xy[<span class="dv">11</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="fl">1.0</span>
</div>
<div class="sourceLine" id="cb9-14" data-line-number="14">xy[<span class="dv">12</span>,<span class="dv">1</span>] &lt;-<span class="fl">1.5</span>
</div>
<div class="sourceLine" id="cb9-15" data-line-number="15">xy[<span class="dv">9</span><span class="op">:</span><span class="dv">10</span>,<span class="dv">2</span>] &lt;-<span class="st"> </span>xy[<span class="dv">5</span><span class="op">:</span><span class="dv">6</span>,<span class="dv">2</span>]</div>
<div class="sourceLine" id="cb9-16" data-line-number="16">xy[<span class="dv">11</span><span class="op">:</span><span class="dv">12</span>,<span class="dv">2</span>]&lt;-<span class="kw">c</span>(<span class="fl">1.25</span>,<span class="fl">1.0</span>)</div>
<div class="sourceLine" id="cb9-17" data-line-number="17">
<span class="kw">cbind</span>(sites,surveys,xy)</div></code></pre>
<pre><code>##       sites surveys          
##  [1,]     1       1 0.00 0.00
##  [2,]     1       2 0.00 1.00
##  [3,]     1       3 0.00 2.00
##  [4,]     1       4 0.00 3.00
##  [5,]     2       1 0.25 0.00
##  [6,]     2       2 0.25 1.00
##  [7,]     2       3 0.50 1.50
##  [8,]     2       4 1.00 2.00
##  [9,]     3       1 0.50 0.00
## [10,]     3       2 0.50 1.00
## [11,]     3       3 1.00 1.25
## [12,]     3       4 1.50 1.00</code></pre>
<p>The matrix of Euclidean distances <span class="math inline">\(d\)</span> between community states in <span class="math inline">\(\Omega\)</span> is then:</p>
<pre class="sourceCode r" id="cb11"><code class="sourceCode r"><div class="sourceLine" id="cb11-1" data-line-number="1"><span class="co">#Distance matrix</span></div>
<div class="sourceLine" id="cb11-2" data-line-number="2">D =<span class="st"> </span><span class="kw">dist</span>(xy)</div>
<div class="sourceLine" id="cb11-3" data-line-number="3">D</div></code></pre>
<pre><code>##            1         2         3         4         5         6         7
## 2  1.0000000                                                            
## 3  2.0000000 1.0000000                                                  
## 4  3.0000000 2.0000000 1.0000000                                        
## 5  0.2500000 1.0307764 2.0155644 3.0103986                              
## 6  1.0307764 0.2500000 1.0307764 2.0155644 1.0000000                    
## 7  1.5811388 0.7071068 0.7071068 1.5811388 1.5206906 0.5590170          
## 8  2.2360680 1.4142136 1.0000000 1.4142136 2.1360009 1.2500000 0.7071068
## 9  0.5000000 1.1180340 2.0615528 3.0413813 0.2500000 1.0307764 1.5000000
## 10 1.1180340 0.5000000 1.1180340 2.0615528 1.0307764 0.2500000 0.5000000
## 11 1.6007811 1.0307764 1.2500000 2.0155644 1.4577380 0.7905694 0.5590170
## 12 1.8027756 1.5000000 1.8027756 2.5000000 1.6007811 1.2500000 1.1180340
##            8         9        10        11
## 2                                         
## 3                                         
## 4                                         
## 5                                         
## 6                                         
## 7                                         
## 8                                         
## 9  2.0615528                              
## 10 1.1180340 1.0000000                    
## 11 0.7500000 1.3462912 0.5590170          
## 12 1.1180340 1.4142136 1.0000000 0.5590170</code></pre>
<p>CTA is based on the analysis of information in <span class="math inline">\(d\)</span>. Therefore, it does not require explicit coordinates. This is an advantage because it allows the analysis to be conducted on arbitrary metric (or semi-metric) spaces. The choice of <span class="math inline">\(d\)</span> is left to the user and will depend on the problem at hand.</p>
</div>
<div id="displaying-trajectories" class="section level3">
<h3 class="hasAnchor">
<a href="#displaying-trajectories" class="anchor"></a>2.2 Displaying trajectories</h3>
<p>To begin our analysis of the three trajectories, we display them in an ordination space, using function <code>trajectoryPCoA</code>. Since <span class="math inline">\(\Omega\)</span> has only two dimensions in this example, the Principal Coordinates Analysis (PCoA) on <span class="math inline">\(d\)</span> displays the complete space:</p>
<pre class="sourceCode r" id="cb13"><code class="sourceCode r"><div class="sourceLine" id="cb13-1" data-line-number="1">
<span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>))</div>
<div class="sourceLine" id="cb13-2" data-line-number="2">
<span class="kw"><a href="../reference/trajectories.html">trajectoryPCoA</a></span>(D, sites, surveys, <span class="dt">traj.colors =</span> <span class="kw">c</span>(<span class="st">"black"</span>,<span class="st">"red"</span>, <span class="st">"blue"</span>), <span class="dt">lwd =</span> <span class="dv">2</span>)</div>
<div class="sourceLine" id="cb13-3" data-line-number="3">
<span class="kw">legend</span>(<span class="st">"topleft"</span>, <span class="dt">col=</span><span class="kw">c</span>(<span class="st">"black"</span>,<span class="st">"red"</span>, <span class="st">"blue"</span>), </div>
<div class="sourceLine" id="cb13-4" data-line-number="4">       <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">"Trajectory 1"</span>, <span class="st">"Trajectory 2"</span>, <span class="st">"Trajectory 3"</span>), <span class="dt">bty=</span><span class="st">"n"</span>, <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</div></code></pre>
<p><img src="CTA_files/figure-html/pcoa-1.png" width="384" style="display: block; margin: auto;"></p>
<p>While trajectory of site ‘1’ (black arrows) is made of three segments of the same length and direction, trajectory of site ‘2’ (red arrows) has a second and third segments that bend and are shorter than that of the segond segment of site ‘1’. Trajectory of site ‘3’ includes a stronger change in direction and shorter segments.</p>
<p>As this example has two dimensions and we used Euclidean distance, the same plot (albeit rotated) can be straightforwardly obtained using matrix <code>xy</code> and function <code>trajectoryPlot</code>:</p>
<pre class="sourceCode r" id="cb14"><code class="sourceCode r"><div class="sourceLine" id="cb14-1" data-line-number="1">
<span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>))</div>
<div class="sourceLine" id="cb14-2" data-line-number="2">
<span class="kw"><a href="../reference/trajectories.html">trajectoryPlot</a></span>(xy, sites, surveys, <span class="dt">traj.colors =</span> <span class="kw">c</span>(<span class="st">"black"</span>,<span class="st">"red"</span>, <span class="st">"blue"</span>), <span class="dt">lwd =</span> <span class="dv">2</span>)</div>
<div class="sourceLine" id="cb14-3" data-line-number="3">
<span class="kw">legend</span>(<span class="st">"topright"</span>, <span class="dt">col=</span><span class="kw">c</span>(<span class="st">"black"</span>,<span class="st">"red"</span>, <span class="st">"blue"</span>), </div>
<div class="sourceLine" id="cb14-4" data-line-number="4">       <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">"Trajectory 1"</span>, <span class="st">"Trajectory 2"</span>, <span class="st">"Trajectory 3"</span>), <span class="dt">bty=</span><span class="st">"n"</span>, <span class="dt">lty=</span><span class="dv">1</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</div></code></pre>
<p><img src="CTA_files/figure-html/xy-1.png" width="384" style="display: block; margin: auto;"></p>
<p>While <code>trajectoryPCoA</code> uses PCoA (also known as classical Multidimensional Scaling) to display trajectories, users can display community trajectories using other ordination techniques such as metric Multidimensional Scaling (mMDS; see function <em>mds</em> of package <strong>smacof</strong>) or non-metric MDS (nMDS; see function <em>metaMDS</em> in package <strong>vegan</strong> or function <em>isoMDS</em> in package <strong>MASS</strong>). Function <code>trajectoryPlot</code> will help drawing arrows between segments to represent trajectories on the ordination space given by any of these methods.</p>
<p>Functions <code>trajectoryPCoA</code>and <code>trajectoryPlot</code> allow selecting the subset of trajectories to be displayed, so that the representation can focus on particular pathways (see also function <code>trajectorySelection</code>).</p>
</div>
<div id="trajectory-lengths-angles-and-overall-directionality" class="section level3">
<h3 class="hasAnchor">
<a href="#trajectory-lengths-angles-and-overall-directionality" class="anchor"></a>2.3 Trajectory lengths, angles and overall directionality</h3>
<p>One may be interested in studying the geometric properties of particular trajectories. For example, one can obtain the length of trajectory segments and the total pathway length using function <code>trajectoryLengths</code>:</p>
<pre class="sourceCode r" id="cb15"><code class="sourceCode r"><div class="sourceLine" id="cb15-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryLengths</a></span>(D, sites, surveys)</div></code></pre>
<pre><code>##   S1       S2        S3 Trajectory
## 1  1 1.000000 1.0000000   3.000000
## 2  1 0.559017 0.7071068   2.266124
## 3  1 0.559017 0.5590170   2.118034</code></pre>
<p>In CTA, angles are measured using triplets of time-ordered community states (a pair of consecutive segments is an example of such triplets). As <span class="math inline">\(d\)</span> may represent a space of multiple dimensions, angles cannot be calculated with respect to a single plane. Instead, each angle is measured on the plane defined by each triplet. Zero angles indicate that the three points (e.g. the two consecutive segments) are in a straight line. The larger the angle value, the more is trajectory changing in direction. Mean and standard deviation statistics of angles are calculated according to circular statistics (see R package <code>circular</code>). Function <code>trajectoryAngles</code> allows calculating the angles between consecutive segments:</p>
<pre class="sourceCode r" id="cb17"><code class="sourceCode r"><div class="sourceLine" id="cb17-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryAngles</a></span>(D, sites, surveys)</div></code></pre>
<pre><code>##      S1-S2    S2-S3     mean         sd       rho
## 1  0.00000  0.00000  0.00000 0.00000000 1.0000000
## 2 26.56505 18.43495 22.50000 0.07097832 0.9974842
## 3 63.43495 53.13010 58.28253 0.08998746 0.9959593</code></pre>
<p>While site ‘1’ follows a straight pathway, angles are &gt; 0 for trajectories of site ‘2’ and ‘3’, denoting the change in direction. In this case, the same information could be obtained by inspecting the previous plots, but in a case where <span class="math inline">\(\Omega\)</span> has many dimensions, the representation will correspond to a reduced (ordination) space and hence, angles and lengths in the plot will not correspond exactly to those of functions <code>trajectoryLengths</code> and <code>trajectoryAngles</code>, which take into account the complete <span class="math inline">\(\Omega\)</span> space.</p>
<p>Angles can be calculated not only for all consecutive segments but for all four triplets of ordered community states, whether of consecutive segments or not (i.e., between points 1-2-3, 1-2-4, 1-3-4 and 2-3-4). This is done by specifying <code>all=TRUE</code> in <code>trajectoryAngles</code>:</p>
<pre class="sourceCode r" id="cb19"><code class="sourceCode r"><div class="sourceLine" id="cb19-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryAngles</a></span>(D, sites, surveys, <span class="dt">all=</span><span class="ot">TRUE</span>)</div></code></pre>
<pre><code>##         A1      A2       A3       A4     mean        sd       rho
## 1  0.00000  0.0000  0.00000  0.00000  0.00000 0.0000000 1.0000000
## 2 26.56505 36.8699 35.53768 18.43495 29.36033 0.1300790 0.9915754
## 3 63.43495 90.0000 94.76364 53.13010 75.36015 0.3078934 0.9537066</code></pre>
<p>The <em>mean resultant length</em> of circular statistics (column <code>rho</code> of the previous result), which takes values between 0 and 1, can be used to assess the degree of homogeneity of angle values and it will take a value of 1 if all angles are the same. This approach, however, uses only angular information and does not take into account the length of segments.</p>
<p>To measure the overall directionality of a community trajectory (i.e. if the pathway consistently follows the same direction in <span class="math inline">\(\Omega\)</span> ), we recommend using another statistic that is sensitive to both angles and segment lengths and is implemented in function <code>trajectoryDirectionality</code>:</p>
<pre class="sourceCode r" id="cb21"><code class="sourceCode r"><div class="sourceLine" id="cb21-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryDirectionality</a></span>(D, sites, surveys)</div></code></pre>
<pre><code>##         1         2         3 
## 1.0000000 0.8274026 0.5620859</code></pre>
<p>As known from previous plots, trajectory of site ‘2’ is less straight than trajectory of site ‘1’ and that of site ‘3’ has the lowest directionality value. Note that function only computes a descriptive statistic, i.e. it does not perform any statistical test on directionality.</p>
</div>
<div id="relative-positions-within-trajectories" class="section level3">
<h3 class="hasAnchor">
<a href="#relative-positions-within-trajectories" class="anchor"></a>2.4 Relative positions within trajectories</h3>
<p>Community states occupy a position within their trajectory that depends on the total pathway length of the trajectory. By adding the length of segments prior to a given state and dividing the sum by the total length of the trajectory we obtain the relative position of the community state. Function <code>trajectoryProjection</code> allows obtaining the relative position of each point of a trajectory. To use it for this purpose one should use as parameters the distance matrix between state and the indices that conform the trajectory. For example for the two example trajectories we would have:</p>
<pre class="sourceCode r" id="cb23"><code class="sourceCode r"><div class="sourceLine" id="cb23-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryProjection</a></span>(D, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</div></code></pre>
<pre><code>##   distanceToTrajectory segment relativePosition
## 1                    0       1        0.0000000
## 2                    0       1        0.3333333
## 3                    0       2        0.6666667
## 4                    0       3        1.0000000</code></pre>
<pre class="sourceCode r" id="cb25"><code class="sourceCode r"><div class="sourceLine" id="cb25-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryProjection</a></span>(D, <span class="dv">5</span><span class="op">:</span><span class="dv">8</span>, <span class="dv">5</span><span class="op">:</span><span class="dv">8</span>)</div></code></pre>
<pre><code>##   distanceToTrajectory segment relativePosition
## 5                    0       1        0.0000000
## 6                    0       1        0.4412822
## 7                    0       2        0.6879664
## 8                   NA      NA               NA</code></pre>
<p>Because the trajectory of site ‘2’ as the second and third segments that are longer than the first, the relative position of state ‘6’ is lower than 1/3 and that of state ‘7’ is lower than 2/3.</p>
<p>Function <code>trajectoryProjection</code> can also be used to <strong>project</strong> arbitrary community states onto a given reference trajectory. For example we can study the projection of third state of the trajectory of site ‘1’ (i.e. state 3) onto the trajectory of site ‘2’ (i.e. states 5 to 8):</p>
<pre class="sourceCode r" id="cb27"><code class="sourceCode r"><div class="sourceLine" id="cb27-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryProjection</a></span>(D, <span class="dv">3</span>, <span class="dv">5</span><span class="op">:</span><span class="dv">8</span>)</div></code></pre>
<pre><code>##   distanceToTrajectory segment relativePosition
## 3            0.7071068       3        0.6879664</code></pre>
</div>
<div id="trajectory-convergence" class="section level3">
<h3 class="hasAnchor">
<a href="#trajectory-convergence" class="anchor"></a>2.5 Trajectory convergence</h3>
<p>When trajectories have been sampled the same number of times, function <code>trajectoryConvergence</code> allows performing tests of convergence based on the trend analysis of the sequences of distances between points of the two trajectories (i.e. first-first, second-second, …):</p>
<pre class="sourceCode r" id="cb29"><code class="sourceCode r"><div class="sourceLine" id="cb29-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryConvergence</a></span>(D, sites, surveys, <span class="dt">symmetric =</span> <span class="ot">TRUE</span>)</div></code></pre>
<pre><code>## $tau
##           1         2         3
## 1        NA 0.9128709 0.9128709
## 2 0.9128709        NA 0.9128709
## 3 0.9128709 0.9128709        NA
## 
## $p.value
##           1         2         3
## 1        NA 0.1485617 0.1485617
## 2 0.1485617        NA 0.1485617
## 3 0.1485617 0.1485617        NA</code></pre>
<p>The function performs the Mann-Whitney trend test. Values of the statistic (‘tau’) larger than 0 correspond to trajectories that are diverging, whereas values lower than 0 correspond to trajectories that are converging. By setting <code>symmetric = FALSE</code> the convergence test becomes asymmetric. In this case the sequence of distances <em>between every point of one trajectory and the other</em>:</p>
<pre class="sourceCode r" id="cb31"><code class="sourceCode r"><div class="sourceLine" id="cb31-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryConvergence</a></span>(D, sites, surveys, <span class="dt">symmetric =</span> <span class="ot">FALSE</span>)</div></code></pre>
<pre><code>## WARNING: Error exit, tauk2. IFAULT =  12</code></pre>
<pre><code>## $tau
##           1         2         3
## 1        NA 0.9128709 0.9128709
## 2 0.9128709        NA 0.8164966
## 3 0.9128709 0.6666666        NA
## 
## $p.value
##           1         2         3
## 1        NA 0.1485617 0.1485617
## 2 0.1485617        NA 1.0000000
## 3 0.1485617 0.3081795        NA</code></pre>
<p>The asymmetric test is useful to determine if one trajectory is becoming closer to the other or if it is departing from the other.</p>
</div>
<div id="distances-between-segments-and-trajectories" class="section level3">
<h3 class="hasAnchor">
<a href="#distances-between-segments-and-trajectories" class="anchor"></a>2.6 Distances between segments and trajectories</h3>
<p>To start comparing trajectories between sites (i.e. between sampling units), one important step is the calculation of distances between directed segments, which can be obtained by calling function <code>segmentDistances</code>:</p>
<pre class="sourceCode r" id="cb34"><code class="sourceCode r"><div class="sourceLine" id="cb34-1" data-line-number="1">Ds =<span class="st"> </span><span class="kw"><a href="../reference/trajectories.html">segmentDistances</a></span>(D, sites, surveys)<span class="op">$</span>Dseg</div>
<div class="sourceLine" id="cb34-2" data-line-number="2">Ds</div></code></pre>
<pre><code>##           1[1-2]    1[2-3]    1[3-4]    2[1-2]    2[2-3]    2[3-4]
## 1[2-3] 1.0000000                                                  
## 1[3-4] 2.0000000 1.0000000                                        
## 2[1-2] 0.2500000 1.0307764 2.0155644                              
## 2[2-3] 1.0307764 0.7071068 1.5811388 1.0000000                    
## 2[3-4] 1.5811388 1.0000000 1.4142136 1.5206906 0.7071068          
## 3[1-2] 0.5000000 1.1180340 2.0615528 0.2500000 1.0307764 1.5000000
## 3[2-3] 1.1180340 1.1180340 2.0124612 1.0307764 0.5590170 0.7500000
## 3[3-4] 1.6007811 1.5590170 2.0155644 1.4577380 1.1180340 1.0606602
##           3[1-2]    3[2-3]
## 1[2-3]                    
## 1[3-4]                    
## 2[1-2]                    
## 2[2-3]                    
## 2[3-4]                    
## 3[1-2]                    
## 3[2-3] 1.0000000          
## 3[3-4] 1.5590170 0.5590170</code></pre>
<p>Distances between segments are affected by differences in both <em>position</em>, <em>size</em> and <em>direction</em>. Hence, among the six segments of this example, the distance is maximum between the last segment of trajectory ‘1’ and the first segment of trajectory ‘3’.</p>
<p>One can display distances between segments in two dimensions using mMDS.</p>
<pre class="sourceCode r" id="cb36"><code class="sourceCode r"><div class="sourceLine" id="cb36-1" data-line-number="1">mMDS =<span class="st"> </span><span class="kw">mds</span>(Ds)</div>
<div class="sourceLine" id="cb36-2" data-line-number="2">mMDS</div></code></pre>
<pre><code>## 
## Call:
## mds(delta = Ds)
## 
## Model: Symmetric SMACOF 
## Number of objects: 9 
## Stress-1 value: 0.062 
## Number of iterations: 15</code></pre>
<pre class="sourceCode r" id="cb38"><code class="sourceCode r"><div class="sourceLine" id="cb38-1" data-line-number="1">xret =<span class="st"> </span>mMDS<span class="op">$</span>conf</div>
<div class="sourceLine" id="cb38-2" data-line-number="2">
<span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>))</div>
<div class="sourceLine" id="cb38-3" data-line-number="3">
<span class="kw">plot</span>(xret, <span class="dt">xlab=</span><span class="st">"axis 1"</span>, <span class="dt">ylab =</span> <span class="st">"axis 2"</span>, <span class="dt">asp=</span><span class="dv">1</span>, <span class="dt">pch=</span><span class="dv">21</span>,</div>
<div class="sourceLine" id="cb38-4" data-line-number="4">     <span class="dt">bg=</span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">"black"</span>,<span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">"red"</span>,<span class="dv">3</span>), <span class="kw">rep</span>(<span class="st">"blue"</span>,<span class="dv">3</span>)), </div>
<div class="sourceLine" id="cb38-5" data-line-number="5">     <span class="dt">xlim=</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">1.5</span>,<span class="dv">1</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="fl">1.5</span>))</div>
<div class="sourceLine" id="cb38-6" data-line-number="6">
<span class="kw">text</span>(xret, <span class="dt">labels=</span><span class="kw">rep</span>(<span class="kw">paste0</span>(<span class="st">"s"</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>),<span class="dv">3</span>), <span class="dt">pos=</span><span class="dv">1</span>)</div>
<div class="sourceLine" id="cb38-7" data-line-number="7">
<span class="kw">legend</span>(<span class="st">"topleft"</span>, <span class="dt">pt.bg=</span><span class="kw">c</span>(<span class="st">"black"</span>,<span class="st">"red"</span>,<span class="st">"blue"</span>), <span class="dt">pch=</span><span class="dv">21</span>, <span class="dt">bty=</span><span class="st">"n"</span>, <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">"Trajectory 1"</span>, <span class="st">"Trajectory 2"</span>, <span class="st">"Trajectory 3"</span>))</div></code></pre>
<p><img src="CTA_files/figure-html/unnamed-chunk-13-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Distances between segments are internally calculated when comparing whole trajectories using function <code>trajectoryDistances</code>. Here we show the dissimilarity between the two trajectories as assessed using either the <em>Hausdorff</em> distance (equal to the maximum distance between directed segments) or the <em>directed segment path distance</em> (an average of distances between segments):</p>
<pre class="sourceCode r" id="cb39"><code class="sourceCode r"><div class="sourceLine" id="cb39-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryDistances</a></span>(D, sites, surveys, <span class="dt">distance.type =</span> <span class="st">"Hausdorff"</span>)</div></code></pre>
<pre><code>##          1        2
## 2 2.015564         
## 3 2.061553 1.500000</code></pre>
<pre class="sourceCode r" id="cb41"><code class="sourceCode r"><div class="sourceLine" id="cb41-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryDistances</a></span>(D, sites, surveys, <span class="dt">distance.type =</span> <span class="st">"DSPD"</span>)</div></code></pre>
<pre><code>##           1         2
## 2 0.7214045          
## 3 1.1345910 0.5714490</code></pre>
<p>DSPD is a symmetrized distance. To calculate non-symmetric distances one uses:</p>
<pre class="sourceCode r" id="cb43"><code class="sourceCode r"><div class="sourceLine" id="cb43-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryDistances</a></span>(D, sites, surveys, <span class="dt">distance.type =</span> <span class="st">"DSPD"</span>, <span class="dt">symmetrization =</span> <span class="ot">NULL</span>)</div></code></pre>
<pre><code>##           1         2         3
## 1 0.0000000 0.7904401 1.2101651
## 2 0.6523689 0.0000000 0.5196723
## 3 1.0590170 0.6232257 0.0000000</code></pre>
</div>
</div>
<div id="structural-dynamics-in-permanent-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#structural-dynamics-in-permanent-plots" class="anchor"></a>3. Structural dynamics in permanent plots</h2>
<p>In this example we analyze the dynamics of 8 permanent forest plots located on slopes of a valley in the New Zealand Alps. The study area is mountainous and centered on the Craigieburn Range (Southern Alps), South Island, New Zealand. Forests plots are almost monospecific, being the mountain beech (<em>Fuscospora cliffortioides</em>) the main dominant tree species. Previously forests consisted of largely mature stands, but some of them were affected by different disturbances during the sampling period (1972-2009) which includes 9 surveys. We begin our example by loading the data set, which includes 72 plot observations:</p>
<pre class="sourceCode r" id="cb45"><code class="sourceCode r"><div class="sourceLine" id="cb45-1" data-line-number="1">
<span class="kw">data</span>(<span class="st">"avoca"</span>)</div></code></pre>
<p>Community data is in form of an object <code>stratifiedvegdata</code>. To account for differences in tree diameter, while emphasizing regeneration, the data contains individual counts to represent tree abundance and trees are classified in 19 quadratic diameter bins (in cm): {(2.25, 4], (4, 6.25], (6.25, 9], … (110.25, 121]}. The data set also includes vectors <code>avoca_surveys</code> and <code>avoca_sites</code> that indicate the survey and forest plot corresponding to each forest state.</p>
<p>Before starting community trajectory analysis, we have to use function <code>vegdiststruct</code>to calculate distances between forest plot states in terms of structure and composition:</p>
<pre class="sourceCode r" id="cb46"><code class="sourceCode r"><div class="sourceLine" id="cb46-1" data-line-number="1">avoca_D_man =<span class="st"> </span><span class="kw"><a href="../reference/vegdiststruct.html">vegdiststruct</a></span>(avoca_strat, <span class="dt">method=</span><span class="st">"manhattan"</span>, <span class="dt">transform =</span> <span class="cf">function</span>(x){<span class="kw">log</span>(x<span class="op">+</span><span class="dv">1</span>)})</div></code></pre>
<p>Distances in <code>avoca_D_man</code> are calculated using the Manhattan metric.</p>
<div id="display-trajectories-in-pcoa" class="section level3">
<h3 class="hasAnchor">
<a href="#display-trajectories-in-pcoa" class="anchor"></a>3.1 Display trajectories in PCoA</h3>
<p>The distance matrix <code>avoca_D_man</code> conforms our definition of <span class="math inline">\(\Omega\)</span>. We use <code>trajectoryPCoA</code> to display the relations between forest plot states in this space and to draw the trajectory of each plot:</p>
<pre class="sourceCode r" id="cb47"><code class="sourceCode r"><div class="sourceLine" id="cb47-1" data-line-number="1">
<span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>))</div>
<div class="sourceLine" id="cb47-2" data-line-number="2">
<span class="kw"><a href="../reference/trajectories.html">trajectoryPCoA</a></span>(avoca_D_man,  avoca_sites, avoca_surveys,</div>
<div class="sourceLine" id="cb47-3" data-line-number="3">               <span class="dt">traj.colors =</span> <span class="kw">brewer.pal</span>(<span class="dv">8</span>,<span class="st">"Accent"</span>), </div>
<div class="sourceLine" id="cb47-4" data-line-number="4">               <span class="dt">axes=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">length=</span><span class="fl">0.1</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</div>
<div class="sourceLine" id="cb47-5" data-line-number="5">
<span class="kw">legend</span>(<span class="st">"topright"</span>, <span class="dt">bty=</span><span class="st">"n"</span>, <span class="dt">legend =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>, <span class="dt">col =</span> <span class="kw">brewer.pal</span>(<span class="dv">8</span>,<span class="st">"Accent"</span>), <span class="dt">lwd=</span><span class="dv">2</span>)</div></code></pre>
<p><img src="CTA_files/figure-html/avoca_pcoa-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Note that in this case, the full <span class="math inline">\(\Omega\)</span> includes more than two dimensions, and PCoA is representing 43% of total variance (correction for negative eigenvalues is included in the call to <code>cmdscale</code> from <code>trajectoryPCoA</code>), so one has to be careful when interpreting trajectories visually.</p>
<p>Another option is to use mMDS to represent trajectories, which in this case produces a similar result:</p>
<pre class="sourceCode r" id="cb48"><code class="sourceCode r"><div class="sourceLine" id="cb48-1" data-line-number="1">mMDS =<span class="st"> </span><span class="kw">mds</span>(avoca_D_man)</div>
<div class="sourceLine" id="cb48-2" data-line-number="2">mMDS</div></code></pre>
<pre><code>## 
## Call:
## mds(delta = avoca_D_man)
## 
## Model: Symmetric SMACOF 
## Number of objects: 72 
## Stress-1 value: 0.114 
## Number of iterations: 49</code></pre>
<pre class="sourceCode r" id="cb50"><code class="sourceCode r"><div class="sourceLine" id="cb50-1" data-line-number="1">
<span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>))</div>
<div class="sourceLine" id="cb50-2" data-line-number="2">
<span class="kw"><a href="../reference/trajectories.html">trajectoryPlot</a></span>(mMDS<span class="op">$</span>conf,  avoca_sites, avoca_surveys,</div>
<div class="sourceLine" id="cb50-3" data-line-number="3">               <span class="dt">traj.colors =</span> <span class="kw">brewer.pal</span>(<span class="dv">8</span>,<span class="st">"Accent"</span>), </div>
<div class="sourceLine" id="cb50-4" data-line-number="4">               <span class="dt">axes=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">length=</span><span class="fl">0.1</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</div>
<div class="sourceLine" id="cb50-5" data-line-number="5">
<span class="kw">legend</span>(<span class="st">"topright"</span>, <span class="dt">bty=</span><span class="st">"n"</span>, <span class="dt">legend =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>, <span class="dt">col =</span> <span class="kw">brewer.pal</span>(<span class="dv">8</span>,<span class="st">"Accent"</span>), <span class="dt">lwd=</span><span class="dv">2</span>)</div></code></pre>
<p><img src="CTA_files/figure-html/avoca_mmds-1.png" width="480" style="display: block; margin: auto;"></p>
<p>One can inspect specific trajectories using argument <code>selection</code> in function <code>trajectoryPCoA</code>. This allows getting a better view of particular trajectories, here that of forest plot ‘3’:</p>
<pre class="sourceCode r" id="cb51"><code class="sourceCode r"><div class="sourceLine" id="cb51-1" data-line-number="1">
<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</div>
<div class="sourceLine" id="cb51-2" data-line-number="2">
<span class="kw"><a href="../reference/trajectories.html">trajectoryPCoA</a></span>(avoca_D_man,  avoca_sites, avoca_surveys,</div>
<div class="sourceLine" id="cb51-3" data-line-number="3">               <span class="dt">selection=</span> <span class="dv">3</span>,</div>
<div class="sourceLine" id="cb51-4" data-line-number="4">               <span class="dt">length=</span><span class="fl">0.1</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</div>
<div class="sourceLine" id="cb51-5" data-line-number="5">
<span class="kw">plotTrajDiamDist</span>(<span class="dv">3</span>)</div></code></pre>
<p><img src="CTA_files/figure-html/trajectory_3-1.png" width="768" style="display: block; margin: auto;"></p>
<p>In the right hand, we added a representation of the change in the mountain beech tree diameter distribution through time for trajectory of forest plot ‘3’. The dynamics of this plot include mostly growth, which results in individuals moving from one diameter class to the other. The whole trajectory looks mostly directional. Let’s now inspect the trajectory of forest plot ‘4’:</p>
<pre class="sourceCode r" id="cb52"><code class="sourceCode r"><div class="sourceLine" id="cb52-1" data-line-number="1">
<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</div>
<div class="sourceLine" id="cb52-2" data-line-number="2">
<span class="kw"><a href="../reference/trajectories.html">trajectoryPCoA</a></span>(avoca_D_man,  avoca_sites, avoca_surveys,</div>
<div class="sourceLine" id="cb52-3" data-line-number="3">               <span class="dt">selection=</span> <span class="dv">4</span>,</div>
<div class="sourceLine" id="cb52-4" data-line-number="4">               <span class="dt">length=</span><span class="fl">0.1</span>, <span class="dt">lwd=</span><span class="dv">2</span>)</div>
<div class="sourceLine" id="cb52-5" data-line-number="5">
<span class="kw">plotTrajDiamDist</span>(<span class="dv">4</span>)</div></code></pre>
<p><img src="CTA_files/figure-html/trajectory_4-1.png" width="768" style="display: block; margin: auto;"></p>
<p>This second trajectory is less straight and seems to include a turn by the end of the sampling period, corresponding to the recruitment of new saplings.</p>
</div>
<div id="trajectory-lengths-angles-and-overall-directionality-1" class="section level3">
<h3 class="hasAnchor">
<a href="#trajectory-lengths-angles-and-overall-directionality-1" class="anchor"></a>3.2 Trajectory lengths, angles and overall directionality</h3>
<p>While trajectory lengths and angles can be inspected visually in ordination diagrams, it is better to calculate them using the full <span class="math inline">\(\Omega\)</span> space (i.e., from matrix <code>avoca_D_man</code>). Using function <code>trajectoryLengths</code> we can see that the trajectory of forest plot ‘4’ is lengthier than that of plot ‘3’, mostly because includes a lengthier last segment (i.e. the recruitment of new individuals):</p>
<pre class="sourceCode r" id="cb53"><code class="sourceCode r"><div class="sourceLine" id="cb53-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryLengths</a></span>(avoca_D_man, avoca_sites, avoca_surveys)</div></code></pre>
<pre><code>##          S1        S2        S3        S4        S5        S6        S7
## 1 1.2173214 1.5911988 1.0976965 2.1173501 0.5238760 1.5863283 1.5750365
## 2 0.5971165 1.7469687 0.9866591 0.9413060 1.3687614 0.6280231 1.4565581
## 3 1.1480971 1.2404953 0.6508116 0.4371405 0.5098385 1.2078811 1.6241741
## 4 0.7932307 1.8572629 0.7268623 0.8348635 3.0560437 1.9863939 0.9905892
## 5 1.7769875 0.3367341 0.7283030 0.6515714 1.2660552 0.9544933 1.2605333
## 6 2.1891568 0.5312711 1.0035212 0.4113220 2.1394743 1.0482871 1.4924056
## 7 0.2919002 0.8857645 1.0908604 0.5601649 2.0600208 0.3712067 1.1014563
## 8 0.1909713 1.2000266 2.3211891 0.6539882 2.7807668 0.8170202 1.2072425
##          S8 Trajectory
## 1 0.6277940  10.336602
## 2 1.1232798   8.848673
## 3 1.4536390   8.272077
## 4 3.8794520  14.124698
## 5 0.5842314   7.558909
## 6 1.9623777  10.777816
## 7 1.7518489   8.113223
## 8 1.5107357  10.681940</code></pre>
<p>If we calculate the angles between consecutive segments (using function <code>trajectoryLengths</code>) we see that indeed the trajectory of ‘3’ is rather directional, but the angles of trajectory of ‘4’ are larger, on aveerage:</p>
<pre class="sourceCode r" id="cb55"><code class="sourceCode r"><div class="sourceLine" id="cb55-1" data-line-number="1">avoca_ang &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectories.html">trajectoryAngles</a></span>(avoca_D_man, avoca_sites, avoca_surveys)</div>
<div class="sourceLine" id="cb55-2" data-line-number="2">avoca_ang</div></code></pre>
<pre><code>##       S1-S2        S2-S3        S3-S4     S4-S5     S5-S6     S6-S7
## 1  41.74809 8.669806e+01 7.401875e+01  26.94138 113.40657 100.67068
## 2  68.14891 3.466506e+01 8.537736e-07   0.00000  25.97111   0.00000
## 3  87.24519 3.088828e+01 1.207418e-06   0.00000  50.90743  48.12854
## 4  37.65736 8.537736e-07 8.537736e-07  36.25240  55.53607  74.21065
## 5  42.02156 7.166400e+01 1.207418e-06  49.95436  65.75897  65.82083
## 6  41.69894 4.611675e+01 5.669641e+01 135.84929   0.00000   0.00000
## 7  53.63254 1.152378e+02 6.519921e+01  60.71442   0.00000  56.25733
## 8 180.00000 0.000000e+00 9.213121e+01 132.36445  71.33948  36.43189
##          S7-S8     mean        sd       rho
## 1 1.021996e+02 78.82477 0.5334615 0.8673692
## 2 1.207418e-06 17.61550 0.4257423 0.9133572
## 3 4.568199e+01 37.39925 0.5018798 0.8816663
## 4 4.980332e+01 36.44717 0.4531030 0.9024417
## 5 1.061250e+02 57.89321 0.5239476 0.8717431
## 6 0.000000e+00 34.34150 0.7777287 0.7390195
## 7 1.207418e-06 49.96352 0.6562139 0.8062928
## 8 1.207418e-06 66.68343 1.1601974 0.5101610</code></pre>
<p>By calling function <code>trajectoryDirectionality</code> we can confirm that the trajectory for site ‘4’ is less straight than that of site ‘3’:</p>
<pre class="sourceCode r" id="cb57"><code class="sourceCode r"><div class="sourceLine" id="cb57-1" data-line-number="1">avoca_dir &lt;-<span class="st"> </span><span class="kw"><a href="../reference/trajectories.html">trajectoryDirectionality</a></span>(avoca_D_man, avoca_sites, avoca_surveys)</div>
<div class="sourceLine" id="cb57-2" data-line-number="2">avoca_dir</div></code></pre>
<pre><code>##         1         2         3         4         5         6         7 
## 0.6781369 0.6736490 0.8651467 0.5122482 0.6677116 0.7058465 0.7391775 
##         8 
## 0.5254225</code></pre>
<p>The following code displays the relationship between the statistic in <code>trajectoryDirectionality</code> and the mean resultant vector length that uses angular information only and assesses the constancy of angle values:</p>
<pre class="sourceCode r" id="cb59"><code class="sourceCode r"><div class="sourceLine" id="cb59-1" data-line-number="1">avoca_rho =<span class="st"> </span><span class="kw"><a href="../reference/trajectories.html">trajectoryAngles</a></span>(avoca_D_man, avoca_sites, avoca_surveys, <span class="dt">all=</span><span class="ot">TRUE</span>)<span class="op">$</span>rho</div>
<div class="sourceLine" id="cb59-2" data-line-number="2">
<span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>))</div>
<div class="sourceLine" id="cb59-3" data-line-number="3">
<span class="kw">plot</span>(avoca_rho, avoca_dir, <span class="dt">xlab =</span> <span class="st">"rho(T)"</span>, <span class="dt">ylab =</span> <span class="st">"dir(T)"</span>, <span class="dt">type=</span><span class="st">"n"</span>)</div>
<div class="sourceLine" id="cb59-4" data-line-number="4">
<span class="kw">text</span>(avoca_rho, avoca_dir, <span class="kw">as.character</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">8</span>))</div></code></pre>
<p><img src="CTA_files/figure-html/unnamed-chunk-16-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="distances-between-trajectories" class="section level3">
<h3 class="hasAnchor">
<a href="#distances-between-trajectories" class="anchor"></a>3.3 Distances between trajectories</h3>
<p>We can calculate the resemblance between forest plot trajectories using <code>trajectoryDistances</code>:</p>
<pre><code>##       1     2     3     4     5     6     7
## 2 2.405                                    
## 3 6.805 5.773                              
## 4 6.123 6.646 5.225                        
## 5 6.020 5.541 3.235 4.966                  
## 6 9.490 8.866 3.436 6.043 4.505            
## 7 4.024 3.291 4.365 4.993 4.389 6.205      
## 8 9.797 9.747 5.591 4.611 6.383 5.043 6.949</code></pre>
<p>The closest trajectories are those of plots ‘1’ and ‘2’. They looked rather close in <em>position</em> in the PCoA ordination of <span class="math inline">\(\Omega\)</span> with all trajectories, so probably it is position, rather than <em>shape</em> which has influenced this low value. The next pair of similar trajectories are those of the ‘3’-‘5’ pair. We can again use mMDS to produce an ordination of resemblances between trajectories:</p>
<pre class="sourceCode r" id="cb61"><code class="sourceCode r"><div class="sourceLine" id="cb61-1" data-line-number="1">mMDS&lt;-<span class="kw">mds</span>(avoca_D_traj_man)</div>
<div class="sourceLine" id="cb61-2" data-line-number="2">mMDS</div></code></pre>
<pre><code>## 
## Call:
## mds(delta = avoca_D_traj_man)
## 
## Model: Symmetric SMACOF 
## Number of objects: 8 
## Stress-1 value: 0.091 
## Number of iterations: 25</code></pre>
<pre class="sourceCode r" id="cb63"><code class="sourceCode r"><div class="sourceLine" id="cb63-1" data-line-number="1">x&lt;-mMDS<span class="op">$</span>conf[,<span class="dv">1</span>]</div>
<div class="sourceLine" id="cb63-2" data-line-number="2">y&lt;-mMDS<span class="op">$</span>conf[,<span class="dv">2</span>]</div>
<div class="sourceLine" id="cb63-3" data-line-number="3">
<span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>))</div>
<div class="sourceLine" id="cb63-4" data-line-number="4">
<span class="kw">plot</span>(x,y, <span class="dt">type=</span><span class="st">"p"</span>, <span class="dt">asp=</span><span class="dv">1</span>, <span class="dt">xlab=</span><span class="kw">paste0</span>(<span class="st">"Axis 1"</span>), </div>
<div class="sourceLine" id="cb63-5" data-line-number="5">     <span class="dt">ylab=</span><span class="kw">paste0</span>(<span class="st">"Axis 2"</span>), <span class="dt">col=</span><span class="st">"black"</span>,</div>
<div class="sourceLine" id="cb63-6" data-line-number="6">     <span class="dt">bg=</span> <span class="kw">brewer.pal</span>(<span class="dv">8</span>,<span class="st">"Accent"</span>), <span class="dt">pch=</span><span class="dv">21</span>)</div>
<div class="sourceLine" id="cb63-7" data-line-number="7">
<span class="kw">text</span>(x,y, <span class="dt">labels=</span><span class="dv">1</span><span class="op">:</span><span class="dv">8</span>, <span class="dt">pos=</span><span class="dv">1</span>)</div></code></pre>
<p><img src="CTA_files/figure-html/avoca_DT_PCoA-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Distances between trajectories can be calculated after centering them (i.e. after bringing all trajectories to the center of the <span class="math inline">\(\Omega\)</span> space). This is done using function <code>centerTrajectories</code>, which returns a new dissimilarity matrix. Centering removes differences in <em>position</em> between trajectories, which is useful in cases where one wants to focus on spatio-temporal interaction while discarding spatial patterns that are constant in time. We do no illustrate centering here, because in is not interesting for this particular example.</p>
</div>
</div>
<div id="transformation-of-dissimilarities-in-community-trajectory-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#transformation-of-dissimilarities-in-community-trajectory-analysis" class="anchor"></a>4. Transformation of dissimilarities in community trajectory analysis</h2>
<div id="introduction-1" class="section level3">
<h3 class="hasAnchor">
<a href="#introduction-1" class="anchor"></a>4.1 Introduction</h3>
<p>Some dissimilarity coefficients that are popular in community ecology, such as the percentage difference (alias Bray-Curtis), have the drawback of being a non-Euclidean (dissimilarity matrices do not allow a representation in a Cartesian space), or even semi-metric (i.e. triangle inequality is not ensured). In order to use these coefficients in multivariate analyses that require these properties a transformation of the original space will normally be in order. In this section, we compare different alternatives and provide some recommendations on this issue.</p>
</div>
<div id="effect-of-square-root-on-a-simple-directional-trajectory" class="section level3">
<h3 class="hasAnchor">
<a href="#effect-of-square-root-on-a-simple-directional-trajectory" class="anchor"></a>4.2 Effect of square root on a simple directional trajectory</h3>
<p>Here, we use an example of a single synthetic community to illustrate the effect of square root transformation on a community trajectory. We begin by defining the species data of the trajectory itself. The dataset consists of four rows (i.e. surveys) and four columns (species). The dynamics in this example consist in an constant increase in the number of individuals of the first species and a corresponding decrease of the others, while keeping a total abundance of 100 individuals:</p>
<pre class="sourceCode r" id="cb64"><code class="sourceCode r"><div class="sourceLine" id="cb64-1" data-line-number="1">sites =<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>,<span class="dv">4</span>)</div>
<div class="sourceLine" id="cb64-2" data-line-number="2">surveys=<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>
</div>
<div class="sourceLine" id="cb64-3" data-line-number="3">spdata =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">35</span>,<span class="dv">30</span>,<span class="dv">20</span>,<span class="dv">15</span>),</div>
<div class="sourceLine" id="cb64-4" data-line-number="4">               <span class="kw">c</span>(<span class="dv">50</span>,<span class="dv">25</span>,<span class="dv">15</span>,<span class="dv">10</span>),</div>
<div class="sourceLine" id="cb64-5" data-line-number="5">               <span class="kw">c</span>(<span class="dv">65</span>,<span class="dv">20</span>,<span class="dv">10</span>,<span class="dv">5</span>),</div>
<div class="sourceLine" id="cb64-6" data-line-number="6">               <span class="kw">c</span>(<span class="dv">80</span>,<span class="dv">15</span>,<span class="dv">5</span>,<span class="dv">0</span>))</div></code></pre>
<p>We now use function <code>vegdist</code> from package <code>vegan</code> to calculate the Bray-Curtis coefficient:</p>
<pre class="sourceCode r" id="cb65"><code class="sourceCode r"><div class="sourceLine" id="cb65-1" data-line-number="1">D =<span class="st"> </span>vegan<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/vegan/topics/vegdist">vegdist</a></span>(spdata, <span class="st">"bray"</span>)</div>
<div class="sourceLine" id="cb65-2" data-line-number="2">
<span class="kw"><a href="../reference/trajectories.html">is.metric</a></span>(D)</div></code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="sourceCode r" id="cb67"><code class="sourceCode r"><div class="sourceLine" id="cb67-1" data-line-number="1">D</div></code></pre>
<pre><code>##      1    2    3
## 2 0.15          
## 3 0.30 0.15     
## 4 0.45 0.30 0.15</code></pre>
<p>This dissimilarity matrix is a metric, so one would not need any transformation for CTA. However, it is a good example to illustrate the effect of the square root transformation.</p>
<p>If we draw the resemblance space corresponding to this dissimilarity matrix we see a straight trajectory:</p>
<pre class="sourceCode r" id="cb69"><code class="sourceCode r"><div class="sourceLine" id="cb69-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryPCoA</a></span>(D,sites,surveys)</div></code></pre>
<p><img src="CTA_files/figure-html/unnamed-chunk-19-1.png" width="576" style="display: block; margin: auto;"> Here we see that Bray-Curtis dissimilarity responds linearly to the proposed sequence of community dynamics. To confirm this geometry, we can calculate the geometric properties of the trajectory (i.e. length, angle between consecutive segments and overall directionality):</p>
<pre class="sourceCode r" id="cb70"><code class="sourceCode r"><div class="sourceLine" id="cb70-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryLengths</a></span>(D,sites,surveys)</div></code></pre>
<pre><code>##     S1   S2   S3 Trajectory
## 1 0.15 0.15 0.15       0.45</code></pre>
<pre class="sourceCode r" id="cb72"><code class="sourceCode r"><div class="sourceLine" id="cb72-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryAngles</a></span>(D,sites,surveys)</div></code></pre>
<pre><code>##   S1-S2 S2-S3 mean sd rho
## 1     0     0    0  0   1</code></pre>
<pre class="sourceCode r" id="cb74"><code class="sourceCode r"><div class="sourceLine" id="cb74-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryDirectionality</a></span>(D,sites,surveys)</div></code></pre>
<pre><code>## 1 
## 1</code></pre>
<p>Angles are 0 degrees and overall directionality is maximum (i.e. 1), in accordance with the plot and the data. We now proceed to take the square root of the dissimilarity values, as would be necessary to achieve a metric (and Euclidean) space in a more complex data set:</p>
<pre class="sourceCode r" id="cb76"><code class="sourceCode r"><div class="sourceLine" id="cb76-1" data-line-number="1">sqrtD =<span class="st"> </span><span class="kw">sqrt</span>(D)</div>
<div class="sourceLine" id="cb76-2" data-line-number="2">sqrtD</div></code></pre>
<pre><code>##           1         2         3
## 2 0.3872983                    
## 3 0.5477226 0.3872983          
## 4 0.6708204 0.5477226 0.3872983</code></pre>
<p>The transformation increases all dissimilarity values (because the original values are smaller than 1), but the increase is larger for smaller values, so the ratio between large dissimilarities and small dissimilarities decreases. This has an effect on the overall shape of the trajectory, which surprisingly now looks like:</p>
<pre class="sourceCode r" id="cb78"><code class="sourceCode r"><div class="sourceLine" id="cb78-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryPCoA</a></span>(sqrtD,sites,surveys)</div></code></pre>
<p><img src="CTA_files/figure-html/unnamed-chunk-22-1.png" width="576" style="display: block; margin: auto;"></p>
<p>In addition to the distortion observed, the number of dimensions of the data have increased (i.e the sum of variance explained by the two axes is 88% &lt; 100%), so we cannot be sure that the angles are well represented. If we re-calculate the properties of the trajectory taking into account all dimensions we obtain:</p>
<pre class="sourceCode r" id="cb79"><code class="sourceCode r"><div class="sourceLine" id="cb79-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryLengths</a></span>(sqrtD,sites,surveys)</div></code></pre>
<pre><code>##          S1        S2        S3 Trajectory
## 1 0.3872983 0.3872983 0.3872983   1.161895</code></pre>
<pre class="sourceCode r" id="cb81"><code class="sourceCode r"><div class="sourceLine" id="cb81-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryAngles</a></span>(sqrtD,sites,surveys)</div></code></pre>
<pre><code>##   S1-S2 S2-S3 mean sd rho
## 1    90    90   90  0   1</code></pre>
<pre class="sourceCode r" id="cb83"><code class="sourceCode r"><div class="sourceLine" id="cb83-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryAngles</a></span>(sqrtD,sites,surveys, <span class="dt">all=</span><span class="ot">TRUE</span>)</div></code></pre>
<pre><code>##   A1 A2 A3 A4 mean sd rho
## 1 90 90 90 90   90  0   1</code></pre>
<pre class="sourceCode r" id="cb85"><code class="sourceCode r"><div class="sourceLine" id="cb85-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryDirectionality</a></span>(sqrtD,sites,surveys)</div></code></pre>
<pre><code>##   1 
## 0.5</code></pre>
<p>The length of segments and the trajectory have increased, but all segments are of the same length, in agreement with the original trajectory. In contrast, the angles are now 90 degrees and the overall directionality has decreased substantially.</p>
</div>
<div id="effect-of-different-transformations-on-more-complex-trajectories" class="section level3">
<h3 class="hasAnchor">
<a href="#effect-of-different-transformations-on-more-complex-trajectories" class="anchor"></a>4.3 Effect of different transformations on more complex trajectories</h3>
<p>Here we use simulated data to compare four transformation approaches:</p>
<ol style="list-style-type: decimal">
<li>Local transformation of semi-metric dissimilarities (such as the percentage difference) in every triplet when the triangle inequality is required. This is done by default in the CTA functions of package <code>vegclust</code>.</li>
<li>Global transformation of dissimilarities, using the square root.</li>
<li>Global transformation of dissimilarities by using Principal Coordinates Analysis (classical multidimensional scaling) with eigenvalue correction.</li>
<li>Global transformation of dissimilarities by using metric multidimensional scaling (metric MDS).</li>
</ol>
<p>We use simulated dynamics to build another trajectory with more species (20) and more time steps. We begin by setting the number of time steps (50) and the size of the community (50 individuals):</p>
<pre class="sourceCode r" id="cb87"><code class="sourceCode r"><div class="sourceLine" id="cb87-1" data-line-number="1">Nsteps =<span class="st"> </span><span class="dv">50</span>
</div>
<div class="sourceLine" id="cb87-2" data-line-number="2">CC =<span class="st"> </span><span class="dv">50</span>
</div>
<div class="sourceLine" id="cb87-3" data-line-number="3">Nreplace &lt;-<span class="st"> </span>CC<span class="op">*</span><span class="fl">0.05</span>
</div></code></pre>
<p><code>Nreplace</code> is the number of individuals to be replaced each time step (5%). Now we define the initial community vector and the vector with the probabilities of offspring for each species according to some ecological conditions:</p>
<pre class="sourceCode r" id="cb88"><code class="sourceCode r"><div class="sourceLine" id="cb88-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">67</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">0</span>)</div>
<div class="sourceLine" id="cb88-2" data-line-number="2">poffspring &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.002</span>, <span class="fl">0.661</span> ,<span class="dv">0</span> ,<span class="dv">0</span>, <span class="fl">0.037</span>, <span class="fl">0.281</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.008</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.005</span>, <span class="fl">0.003</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</div></code></pre>
<p>We can now simulate the dynamics by sequentially applying stochastic deaths and recruitment:</p>
<pre class="sourceCode r" id="cb89"><code class="sourceCode r"><div class="sourceLine" id="cb89-1" data-line-number="1">m &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, <span class="dt">nrow=</span>Nsteps<span class="op">+</span><span class="dv">1</span>, <span class="dt">ncol=</span><span class="kw">length</span>(x))</div>
<div class="sourceLine" id="cb89-2" data-line-number="2">m[<span class="dv">1</span>, ] =<span class="st"> </span>x</div>
<div class="sourceLine" id="cb89-3" data-line-number="3">
<span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>Nsteps) {</div>
<div class="sourceLine" id="cb89-4" data-line-number="4">  pdeath &lt;-x<span class="op">/</span><span class="kw">sum</span>(x) <span class="co">#Equal probability of dying</span>
</div>
<div class="sourceLine" id="cb89-5" data-line-number="5">  deaths&lt;-<span class="kw">rmultinom</span>(<span class="dv">1</span>,Nreplace, pdeath)</div>
<div class="sourceLine" id="cb89-6" data-line-number="6">  x &lt;-<span class="st"> </span><span class="kw">pmax</span>(x <span class="op">-</span><span class="st"> </span>deaths,<span class="dv">0</span>)</div>
<div class="sourceLine" id="cb89-7" data-line-number="7">  offspring =<span class="st"> </span><span class="kw">rmultinom</span>(<span class="dv">1</span>,Nreplace, <span class="kw">as.vector</span>(poffspring))</div>
<div class="sourceLine" id="cb89-8" data-line-number="8">  x &lt;-<span class="st"> </span>x <span class="op">+</span><span class="st"> </span>offspring</div>
<div class="sourceLine" id="cb89-9" data-line-number="9">  m[k<span class="op">+</span><span class="dv">1</span>, ]&lt;-x</div>
<div class="sourceLine" id="cb89-10" data-line-number="10">}</div></code></pre>
<p>Then we decide how frequently (with respect to the simulated step) a sample of the community is taken, here every four steps:</p>
<pre class="sourceCode r" id="cb90"><code class="sourceCode r"><div class="sourceLine" id="cb90-1" data-line-number="1">Sj &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>,Nsteps<span class="op">+</span><span class="dv">1</span>, <span class="dt">by=</span><span class="dv">4</span>) <span class="co">#Sample every four steps</span>
</div>
<div class="sourceLine" id="cb90-2" data-line-number="2">mj &lt;-<span class="st"> </span>m[Sj,]</div>
<div class="sourceLine" id="cb90-3" data-line-number="3">surveys =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(Sj)</div>
<div class="sourceLine" id="cb90-4" data-line-number="4">sites =<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>,<span class="kw">length</span>(Sj))</div></code></pre>
<p>Now we are ready to calculate the Bray-Curtis dissimilarity:</p>
<pre class="sourceCode r" id="cb91"><code class="sourceCode r"><div class="sourceLine" id="cb91-1" data-line-number="1">D &lt;-<span class="st"> </span>vegan<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/vegan/topics/vegdist">vegdist</a></span>(mj,<span class="st">"bray"</span>)</div></code></pre>
<p>In this more complex trajectory, some triangles may not obey the triangle inequality (depending on the simulation). This can be inspected using function <code>is.metric</code>:</p>
<pre class="sourceCode r" id="cb92"><code class="sourceCode r"><div class="sourceLine" id="cb92-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">is.metric</a></span>(D, <span class="dt">tol=</span><span class="fl">0.0000001</span>)</div></code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>Deviations from a metric space, if they exist, will be small, so that local transformation of triangles will be very small.</p>
<p>Local transformations are not possible to display trajectories. When we plot the trajectory using function <code>trajectoryPCoA</code> the global transformation of principal coordinates analysis (PCoA) with negative eigenvalue correction is performed. This is fine to display trajectories, but has problems when measuring angular properties, as we will see.</p>
<pre class="sourceCode r" id="cb94"><code class="sourceCode r"><div class="sourceLine" id="cb94-1" data-line-number="1">pcoa&lt;-<span class="kw"><a href="../reference/trajectories.html">trajectoryPCoA</a></span>(D, sites, surveys, <span class="dt">selection=</span><span class="dv">1</span>,<span class="dt">length=</span><span class="fl">0.1</span>, <span class="dt">axes=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</div></code></pre>
<p><img src="CTA_files/figure-html/unnamed-chunk-30-1.png" width="576" style="display: block; margin: auto;"></p>
<pre class="sourceCode r" id="cb95"><code class="sourceCode r"><div class="sourceLine" id="cb95-1" data-line-number="1">pcoaD =<span class="st"> </span><span class="kw">dist</span>(pcoa<span class="op">$</span>points)</div></code></pre>
<p>The trajectory has some twists derived from stochasticity in death and recruitment. Let’s now look at the square root of the Bray-Curtis dissimilarity:</p>
<pre class="sourceCode r" id="cb96"><code class="sourceCode r"><div class="sourceLine" id="cb96-1" data-line-number="1">sqrtD =<span class="st"> </span><span class="kw">sqrt</span>(D)</div>
<div class="sourceLine" id="cb96-2" data-line-number="2">pcoaSqrt =<span class="st"> </span><span class="kw"><a href="../reference/trajectories.html">trajectoryPCoA</a></span>(sqrtD, sites, surveys, <span class="dt">selection=</span><span class="dv">1</span>,<span class="dt">length=</span><span class="fl">0.1</span>, <span class="dt">axes=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</div></code></pre>
<p><img src="CTA_files/figure-html/unnamed-chunk-31-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Finally, we also transform dissimilarities using metric multidimensional scaling (mMDS), provided by package <code>smacof</code>:</p>
<pre class="sourceCode r" id="cb97"><code class="sourceCode r"><div class="sourceLine" id="cb97-1" data-line-number="1">res &lt;-<span class="st"> </span><span class="kw">mds</span>(D, <span class="dt">ndim =</span> <span class="kw">length</span>(Sj)<span class="op">-</span><span class="dv">1</span>, <span class="dt">type =</span> <span class="st">"interval"</span>)</div>
<div class="sourceLine" id="cb97-2" data-line-number="2">mmdsD &lt;-<span class="st"> </span><span class="kw">dist</span>(res<span class="op">$</span>conf)</div>
<div class="sourceLine" id="cb97-3" data-line-number="3">
<span class="kw"><a href="../reference/trajectories.html">trajectoryPlot</a></span>(res<span class="op">$</span>conf, sites, surveys, <span class="dt">selection=</span><span class="dv">1</span>,<span class="dt">length=</span><span class="fl">0.1</span>, <span class="dt">axes=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</div></code></pre>
<p><img src="CTA_files/figure-html/unnamed-chunk-32-1.png" width="576" style="display: block; margin: auto;"></p>
<p>While the three plots look different, the differences are not striking (besides rotation issues). We can compare the stress of the global solutions:</p>
<pre class="sourceCode r" id="cb98"><code class="sourceCode r"><div class="sourceLine" id="cb98-1" data-line-number="1">
<span class="kw">stress0</span>(D,pcoaSqrt<span class="op">$</span>points, <span class="dt">type=</span><span class="st">"interval"</span>)</div></code></pre>
<pre><code>## [1] 0.05327472</code></pre>
<pre class="sourceCode r" id="cb100"><code class="sourceCode r"><div class="sourceLine" id="cb100-1" data-line-number="1">
<span class="kw">stress0</span>(D,pcoa<span class="op">$</span>points, <span class="dt">type=</span><span class="st">"interval"</span>)</div></code></pre>
<pre><code>## [1] 0.006183776</code></pre>
<pre class="sourceCode r" id="cb102"><code class="sourceCode r"><div class="sourceLine" id="cb102-1" data-line-number="1">
<span class="kw">stress0</span>(D,res<span class="op">$</span>conf, <span class="dt">type=</span><span class="st">"interval"</span>)</div></code></pre>
<pre><code>## [1] 0.01057693</code></pre>
<p>Where we see that the square root leads to the strongest alteration of original dissimilarities. If we calculate geometric properties we are not limited by ordination plots and we can take into account all dimensions.</p>
<pre class="sourceCode r" id="cb104"><code class="sourceCode r"><div class="sourceLine" id="cb104-1" data-line-number="1">anglesD =<span class="st"> </span><span class="kw"><a href="../reference/trajectories.html">trajectoryAngles</a></span>(D,sites,surveys)</div>
<div class="sourceLine" id="cb104-2" data-line-number="2">anglesSqrtD =<span class="st"> </span><span class="kw"><a href="../reference/trajectories.html">trajectoryAngles</a></span>(sqrtD,sites,surveys)</div>
<div class="sourceLine" id="cb104-3" data-line-number="3">anglesPcoaD =<span class="st"> </span><span class="kw"><a href="../reference/trajectories.html">trajectoryAngles</a></span>(pcoaD,sites,surveys)</div>
<div class="sourceLine" id="cb104-4" data-line-number="4">anglesmmdsD =<span class="st"> </span><span class="kw"><a href="../reference/trajectories.html">trajectoryAngles</a></span>(mmdsD,sites,surveys)</div>
<div class="sourceLine" id="cb104-5" data-line-number="5"></div>
<div class="sourceLine" id="cb104-6" data-line-number="6">df&lt;-<span class="kw">as.data.frame</span>(<span class="kw">rbind</span>(anglesD, anglesSqrtD, anglesPcoaD, anglesmmdsD))</div>
<div class="sourceLine" id="cb104-7" data-line-number="7">
<span class="kw">row.names</span>(df)&lt;-<span class="kw">c</span>(<span class="st">"local"</span>, <span class="st">"global.sqrt"</span>, <span class="st">"global.pcoa"</span>, <span class="st">"global.mmds"</span>)</div>
<div class="sourceLine" id="cb104-8" data-line-number="8">
<span class="kw">round</span>(df,<span class="dv">2</span>)</div></code></pre>
<pre><code>##             S1-S2 S2-S3 S3-S4  S4-S5 S5-S6 S6-S7 S7-S8 S8-S9 S9-S10
## local        0.00  0.00  0.00  75.52  0.00  0.00  0.00  0.00   0.00
## global.sqrt 90.00 90.00 90.00 101.78 90.00 90.00 90.00 90.00  90.00
## global.pcoa 78.64 83.29 93.80 103.01 82.80 87.14 87.14 93.40 104.50
## global.mmds 45.70 48.38 59.99  84.96 48.16 54.98 60.68 48.57  77.68
##             S10-S11 S11-S12  mean   sd  rho
## local          0.00     0.0  5.40 0.36 0.94
## global.sqrt   90.00    90.0 91.07 0.06 1.00
## global.pcoa   99.40    93.8 91.53 0.14 0.99
## global.mmds   73.91    15.3 56.36 0.32 0.95</code></pre>
<p>The first call to <code>trajectoryAngles</code> with matrix <code>D</code> represents the default strategy of transforming triangles locally, which involves the weakest transformation of all and can be taken as reference. Both the square root and PCoA with negative eigenvalue correction induce a strong transformation of trajectory angles. The global solution of metric MDS leads to angles that are more similar to those of the local transformation strategy.</p>
<p>If we inspect the overall directionality, the global solution of metric MDS provides a value that is again closer to that of local transformation, compared to PCoA and the square root:</p>
<pre class="sourceCode r" id="cb106"><code class="sourceCode r"><div class="sourceLine" id="cb106-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryDirectionality</a></span>(D,sites,surveys)</div></code></pre>
<pre><code>##         1 
## 0.7254992</code></pre>
<pre class="sourceCode r" id="cb108"><code class="sourceCode r"><div class="sourceLine" id="cb108-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryDirectionality</a></span>(sqrtD,sites,surveys)</div></code></pre>
<pre><code>##         1 
## 0.4666373</code></pre>
<pre class="sourceCode r" id="cb110"><code class="sourceCode r"><div class="sourceLine" id="cb110-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryDirectionality</a></span>(pcoaD,sites,surveys)</div></code></pre>
<pre><code>##         1 
## 0.5401611</code></pre>
<pre class="sourceCode r" id="cb112"><code class="sourceCode r"><div class="sourceLine" id="cb112-1" data-line-number="1">
<span class="kw"><a href="../reference/trajectories.html">trajectoryDirectionality</a></span>(mmdsD,sites,surveys)</div></code></pre>
<pre><code>##         1 
## 0.6400943</code></pre>
</div>
<div id="conclusions" class="section level3">
<h3 class="hasAnchor">
<a href="#conclusions" class="anchor"></a>4.4 Conclusions</h3>
<p>In this small study we compared the effect of different solutions to violation of the triangle inequality. If function <code>is.metric</code> returns TRUE for a given data set one should not worry about violations of the triangle inequality. Local solutions are those that imply the smallest number of changes, but these will not be consistent across triplets, so users may desire to apply a global transformation that produces euclidean spaces. This should be done with care. We have shown how the square root transformation distorts the angles and overall directionality of trajectories on the space defined by the percentage difference (alias Bray-Curtis) dissimilarity index. We suspect that this negative effect of square root transformation on angles happens no matter which coefficient is used to derive the initial distance matrix. Therefore, we advocate for avoiding its use when conducting community trajectory analysis (in particular for angles). The global transformation consisting in the application of PCoA with negative eigenvalue correction is less strong than the square root, but it still strongly change the angles between segments. Perhaps, the less harmful global transformation is provided by metric Multidimensional Scaling, but the need to embed distances in an Euclidean space of all three transformations implies a stronger requirement than being a metric, and results in distortions.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">1. Introduction</a></li>
      <li><a href="#simple-example">2. Simple example</a></li>
      <li><a href="#structural-dynamics-in-permanent-plots">3. Structural dynamics in permanent plots</a></li>
      <li><a href="#transformation-of-dissimilarities-in-community-trajectory-analysis">4. Transformation of dissimilarities in community trajectory analysis</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Miquel De Cáceres.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
